services:
  # --- 1. Database: MongoDB ---
  mongodb:
    image: mongo:8
    container_name: aquasense-mongodb
    volumes:
      # ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå deployment ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢
      - ../deployment/aquasense/mongodb/data/db:/data/db
      - /etc/localtime:/etc/localtime:ro
    restart: always
    networks:
      - aquasense-net
    logging:
      options:
        max-size: "10m"
        max-file: "3"

  # --- 2. Backend API: FastAPI ---
  api:
    build: ./backend
    image: aquasense/api:latest
    container_name: aquasense-api
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ../deployment/aquasense/data:/app/data
    ports:
      - 9090:9000
    environment:
      - PYTHONUNBUFFERED=1
      # ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ DB ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ service 'mongodb'
      - MONGODB_URL=mongodb://mongodb:27017/aquasense
    depends_on:
      - mongodb
    networks:
      - aquasense-net
    restart: always
    env_file:
      - ./backend/.env
    # üåü ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏à‡πâ‡∏á: ‡πÉ‡∏ä‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå run-dev ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô
    command: ./scripts/run-dev
    logging:
      options:
        max-size: "10m"
        max-file: "3"

  # --- 3. Frontend Web: React (Vite) ---
  web:
    build: ./frontend
    image: aquasense/web:latest
    container_name: aquasense-web
    volumes:
      - /etc/localtime:/etc/localtime:ro
    ports:
      - 9091:5173 
    networks:
      - aquasense-net
    depends_on:
      - api
    restart: always
    env_file:
      - ./frontend/.env
    # üåü ‡∏£‡∏±‡∏ô Vite ‡πÅ‡∏ö‡∏ö Dev mode ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏ß‡πâ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Nginx)
    command: npm run dev -- --host 0.0.0.0
    logging:
      options:
        max-size: "10m"
        max-file: "3"

networks:
  aquasense-net:
    driver: bridge

volumes:
  # ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ä‡∏∑‡πà‡∏≠ volume ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
  mongo_data: